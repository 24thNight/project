{"ast":null,"code":"// 预设的中英文问题对\n\n// 更丰富的问题集合\nconst mockQuestionPairs = [{\n  en: \"What is your main motivation for achieving this goal?\",\n  zh: \"请描述一下你想实现这个目标的主要原因是什么？\"\n}, {\n  en: \"In what timeframe would you like to complete this goal?\",\n  zh: \"你希望在什么时间范围内完成这个目标？\"\n}, {\n  en: \"What do you think will be the biggest obstacle to achieving this goal?\",\n  zh: \"你认为实现这个目标的最大障碍是什么？\"\n}, {\n  en: \"What steps have you already taken towards this goal?\",\n  zh: \"你已经采取了哪些步骤来实现这个目标？\"\n}, {\n  en: \"What resources or skills do you need to help you achieve this goal?\",\n  zh: \"你需要什么资源或技能来帮助你实现这个目标？\"\n}, {\n  en: \"How will you measure success for this goal?\",\n  zh: \"你将如何衡量这个目标的成功？\"\n}, {\n  en: \"Who can support you in achieving this goal?\",\n  zh: \"谁能在你实现这个目标的过程中给予你支持？\"\n}, {\n  en: \"What will be your first step towards this goal?\",\n  zh: \"你朝着这个目标迈出的第一步会是什么？\"\n}, {\n  en: \"How much time can you dedicate to this goal each week?\",\n  zh: \"你每周能够为这个目标投入多少时间？\"\n}, {\n  en: \"What potential benefits do you expect to gain from achieving this goal?\",\n  zh: \"实现这个目标后，你期望获得哪些潜在好处？\"\n}];\n\n// 根据语言选择问题列表\nconst getMockQuestions = (lang = 'en') => {\n  return mockQuestionPairs.map(q => q[lang]);\n};\n\n// 生成唯一ID\nconst generateId = () => `id-${Date.now()}-${Math.floor(Math.random() * 1000)}`;\n\n// 模拟延迟\nconst delay = ms => new Promise(resolve => setTimeout(resolve, ms));\n\n// 存储会话状态的缓存\nconst sessionCache = {};\nexport const mockClarificationApi = {\n  // 开始一个新的会话\n  startSession: async (planId, lang = 'en') => {\n    // 模拟网络延迟\n    await delay(800);\n    const sessionId = `session-${Date.now()}`;\n\n    // 初始化会话缓存\n    const questions = getMockQuestions(lang);\n    sessionCache[sessionId] = {\n      currentQuestionIndex: 0,\n      questions,\n      lang,\n      streamNextQuestion: async function () {},\n      // 将在createQuestionStream中设置\n      isClosed: false\n    };\n    return sessionId;\n  },\n  // 提交答案\n  submitAnswer: async (sessionId, answer, lang = 'en') => {\n    // 模拟网络延迟\n    await delay(500);\n\n    // 检查会话是否存在\n    if (!sessionCache[sessionId]) {\n      console.error('[Mock API] Session not found:', sessionId);\n      return false;\n    }\n    const session = sessionCache[sessionId];\n\n    // 如果还有下一个问题，流式发送它\n    if (session.currentQuestionIndex < session.questions.length - 1) {\n      // 增加问题索引\n      session.currentQuestionIndex += 1;\n\n      // 延迟一点时间后发送下一个问题\n      setTimeout(() => {\n        if (!session.isClosed) {\n          session.streamNextQuestion();\n        }\n      }, 800);\n    }\n    return true;\n  },\n  // 完成会话并生成计划\n  completeSession: async sessionId => {\n    // 模拟网络延迟\n    await delay(1200);\n\n    // 清理会话缓存\n    if (sessionCache[sessionId]) {\n      sessionCache[sessionId].isClosed = true;\n      delete sessionCache[sessionId];\n    }\n    return `plan-${Date.now()}`;\n  },\n  // 创建模拟问题流\n  createQuestionStream: (sessionId, onEvent, onError, lang = 'en') => {\n    // 检查会话是否存在\n    if (!sessionCache[sessionId]) {\n      onError(`Session ${sessionId} not found`);\n      return {\n        close: () => {}\n      };\n    }\n    const session = sessionCache[sessionId];\n\n    // 设置流式发送问题的函数\n    session.streamNextQuestion = async () => {\n      if (session.isClosed || session.currentQuestionIndex >= session.questions.length) return;\n      const index = session.currentQuestionIndex;\n      const question = session.questions[index];\n      const questionId = generateId();\n\n      // 模拟流式传输单词\n      const words = question.split(' ');\n\n      // 先发送空字符，触发UI显示\n      onEvent({\n        type: 'question',\n        data: ''\n      });\n\n      // 逐个单词发送，模拟流式效果\n      for (let i = 0; i < words.length; i++) {\n        if (session.isClosed) return;\n\n        // 中文使用较短的延迟，因为字符较少\n        await delay(session.lang === 'zh' ? 200 : 250);\n        onEvent({\n          type: 'question',\n          data: (i === 0 ? '' : ' ') + words[i]\n        });\n      }\n\n      // 发送问题完成事件\n      await delay(300);\n      if (!session.isClosed) {\n        onEvent({\n          type: 'completion',\n          data: 'question completed',\n          id: questionId,\n          questionType: 'open',\n          required: true\n        });\n      }\n    };\n\n    // 开始发送第一个问题\n    setTimeout(() => {\n      if (!session.isClosed) {\n        session.streamNextQuestion();\n      }\n    }, 1000);\n\n    // 返回关闭连接的方法\n    return {\n      close: () => {\n        if (sessionCache[sessionId]) {\n          sessionCache[sessionId].isClosed = true;\n        }\n        console.log('Mock SSE connection closed');\n      }\n    };\n  }\n};","map":{"version":3,"names":["mockQuestionPairs","en","zh","getMockQuestions","lang","map","q","generateId","Date","now","Math","floor","random","delay","ms","Promise","resolve","setTimeout","sessionCache","mockClarificationApi","startSession","planId","sessionId","questions","currentQuestionIndex","streamNextQuestion","isClosed","submitAnswer","answer","console","error","session","length","completeSession","createQuestionStream","onEvent","onError","close","index","question","questionId","words","split","type","data","i","id","questionType","required","log"],"sources":["/home/devbox/project/src/features/clarification/utils/mock-api.ts"],"sourcesContent":["import { Answer, StreamEvent } from '../types';\nimport { Language } from '../../../lib/i18n';\n\n// 预设的中英文问题对\ninterface MockQuestion {\n  en: string;\n  zh: string;\n}\n\n// 更丰富的问题集合\nconst mockQuestionPairs: MockQuestion[] = [\n  {\n    en: \"What is your main motivation for achieving this goal?\",\n    zh: \"请描述一下你想实现这个目标的主要原因是什么？\"\n  },\n  {\n    en: \"In what timeframe would you like to complete this goal?\",\n    zh: \"你希望在什么时间范围内完成这个目标？\"\n  },\n  {\n    en: \"What do you think will be the biggest obstacle to achieving this goal?\",\n    zh: \"你认为实现这个目标的最大障碍是什么？\"\n  },\n  {\n    en: \"What steps have you already taken towards this goal?\",\n    zh: \"你已经采取了哪些步骤来实现这个目标？\"\n  },\n  {\n    en: \"What resources or skills do you need to help you achieve this goal?\",\n    zh: \"你需要什么资源或技能来帮助你实现这个目标？\"\n  },\n  {\n    en: \"How will you measure success for this goal?\",\n    zh: \"你将如何衡量这个目标的成功？\"\n  },\n  {\n    en: \"Who can support you in achieving this goal?\",\n    zh: \"谁能在你实现这个目标的过程中给予你支持？\"\n  },\n  {\n    en: \"What will be your first step towards this goal?\",\n    zh: \"你朝着这个目标迈出的第一步会是什么？\"\n  },\n  {\n    en: \"How much time can you dedicate to this goal each week?\",\n    zh: \"你每周能够为这个目标投入多少时间？\"\n  },\n  {\n    en: \"What potential benefits do you expect to gain from achieving this goal?\",\n    zh: \"实现这个目标后，你期望获得哪些潜在好处？\"\n  }\n];\n\n// 根据语言选择问题列表\nconst getMockQuestions = (lang: Language = 'en'): string[] => {\n  return mockQuestionPairs.map(q => q[lang]);\n};\n\n// 生成唯一ID\nconst generateId = () => `id-${Date.now()}-${Math.floor(Math.random() * 1000)}`;\n\n// 模拟延迟\nconst delay = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));\n\n// 存储会话状态的缓存\nconst sessionCache: Record<string, {\n  currentQuestionIndex: number,\n  questions: string[],\n  lang: Language,\n  streamNextQuestion: () => Promise<void>,\n  isClosed: boolean\n}> = {};\n\nexport const mockClarificationApi = {\n  // 开始一个新的会话\n  startSession: async (planId?: string, lang: Language = 'en') => {\n    // 模拟网络延迟\n    await delay(800);\n    const sessionId = `session-${Date.now()}`;\n    \n    // 初始化会话缓存\n    const questions = getMockQuestions(lang);\n    sessionCache[sessionId] = {\n      currentQuestionIndex: 0,\n      questions,\n      lang,\n      streamNextQuestion: async function() {},  // 将在createQuestionStream中设置\n      isClosed: false\n    };\n    \n    return sessionId;\n  },\n  \n  // 提交答案\n  submitAnswer: async (sessionId: string, answer: Answer, lang: Language = 'en') => {\n    // 模拟网络延迟\n    await delay(500);\n    \n    // 检查会话是否存在\n    if (!sessionCache[sessionId]) {\n      console.error('[Mock API] Session not found:', sessionId);\n      return false;\n    }\n    \n    const session = sessionCache[sessionId];\n    \n    // 如果还有下一个问题，流式发送它\n    if (session.currentQuestionIndex < session.questions.length - 1) {\n      // 增加问题索引\n      session.currentQuestionIndex += 1;\n      \n      // 延迟一点时间后发送下一个问题\n      setTimeout(() => {\n        if (!session.isClosed) {\n          session.streamNextQuestion();\n        }\n      }, 800);\n    }\n    \n    return true;\n  },\n  \n  // 完成会话并生成计划\n  completeSession: async (sessionId: string) => {\n    // 模拟网络延迟\n    await delay(1200);\n    \n    // 清理会话缓存\n    if (sessionCache[sessionId]) {\n      sessionCache[sessionId].isClosed = true;\n      delete sessionCache[sessionId];\n    }\n    \n    return `plan-${Date.now()}`;\n  },\n  \n  // 创建模拟问题流\n  createQuestionStream: (\n    sessionId: string,\n    onEvent: (event: StreamEvent) => void,\n    onError: (error: string) => void,\n    lang: Language = 'en'\n  ) => {\n    // 检查会话是否存在\n    if (!sessionCache[sessionId]) {\n      onError(`Session ${sessionId} not found`);\n      return { close: () => {} };\n    }\n    \n    const session = sessionCache[sessionId];\n    \n    // 设置流式发送问题的函数\n    session.streamNextQuestion = async () => {\n      if (session.isClosed || session.currentQuestionIndex >= session.questions.length) return;\n      \n      const index = session.currentQuestionIndex;\n      const question = session.questions[index];\n      const questionId = generateId();\n      \n      // 模拟流式传输单词\n      const words = question.split(' ');\n      \n      // 先发送空字符，触发UI显示\n      onEvent({\n        type: 'question',\n        data: '',\n      });\n      \n      // 逐个单词发送，模拟流式效果\n      for (let i = 0; i < words.length; i++) {\n        if (session.isClosed) return;\n        \n        // 中文使用较短的延迟，因为字符较少\n        await delay(session.lang === 'zh' ? 200 : 250);\n        \n        onEvent({\n          type: 'question',\n          data: (i === 0 ? '' : ' ') + words[i],\n        });\n      }\n      \n      // 发送问题完成事件\n      await delay(300);\n      \n      if (!session.isClosed) {\n        onEvent({\n          type: 'completion',\n          data: 'question completed',\n          id: questionId,\n          questionType: 'open',\n          required: true\n        });\n      }\n    };\n    \n    // 开始发送第一个问题\n    setTimeout(() => {\n      if (!session.isClosed) {\n        session.streamNextQuestion();\n      }\n    }, 1000);\n    \n    // 返回关闭连接的方法\n    return {\n      close: () => {\n        if (sessionCache[sessionId]) {\n          sessionCache[sessionId].isClosed = true;\n        }\n        console.log('Mock SSE connection closed');\n      }\n    };\n  }\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}