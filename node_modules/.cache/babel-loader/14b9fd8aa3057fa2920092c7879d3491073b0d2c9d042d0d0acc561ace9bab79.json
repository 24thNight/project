{"ast":null,"code":"import axios from 'axios';\nimport { toast } from 'sonner';\nimport { t } from '../../../lib/i18n';\n// API base URL - should be configured based on environment\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'https://jjnucnlvlsaj.sealoshzh.site';\n\n// Create axios instance with the same config as the main API\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  withCredentials: false\n});\n\n// Response interface according to project requirements\n\n// Error handling helper\nconst handleApiError = (error, lang = 'en') => {\n  let errorMessage = t('api.errors.default', lang);\n  if (error && error.response) {\n    var _error$response$data;\n    if ((_error$response$data = error.response.data) !== null && _error$response$data !== void 0 && _error$response$data.message) {\n      errorMessage = error.response.data.message;\n    }\n  } else if (error && error.request) {\n    errorMessage = t('api.errors.network', lang);\n  }\n  toast.error(errorMessage);\n  throw error;\n};\nexport const clarificationApi = {\n  // Start a new clarification session\n  startSession: async (planId, lang = 'en') => {\n    try {\n      const response = await api.post('/clarification/sessions', {\n        planId\n      });\n      return response.data.data.sessionId;\n    } catch (error) {\n      return handleApiError(error, lang);\n    }\n  },\n  // Submit an answer to a question\n  submitAnswer: async (sessionId, answer, lang = 'en') => {\n    try {\n      const response = await api.post(`/clarification/sessions/${sessionId}/answers`, {\n        answer\n      });\n      return response.data.data.success;\n    } catch (error) {\n      return handleApiError(error, lang);\n    }\n  },\n  // Complete the session and generate the plan\n  completeSession: async (sessionId, lang = 'en') => {\n    try {\n      const response = await api.post(`/clarification/sessions/${sessionId}/complete`);\n      return response.data.data.planId;\n    } catch (error) {\n      return handleApiError(error, lang);\n    }\n  },\n  // Create an SSE connection for streaming questions\n  createQuestionStream: (sessionId, onEvent, onError, lang = 'en') => {\n    // Check if EventSource is available\n    if (!window.EventSource) {\n      onError(t('clarify.error.sseError', lang));\n      return {\n        close: () => {}\n      };\n    }\n\n    // Create the SSE connection\n    const eventSource = new EventSource(`${API_BASE_URL}/clarification/sessions/${sessionId}/stream`);\n\n    // Handle events\n    eventSource.onmessage = event => {\n      try {\n        const parsedEvent = JSON.parse(event.data);\n        onEvent(parsedEvent);\n      } catch (err) {\n        if (process.env.NODE_ENV !== 'production') {\n          console.error('Error parsing SSE event:', err);\n        }\n        onError(t('clarify.error.generic', lang));\n      }\n    };\n\n    // Handle connection open\n    eventSource.onopen = () => {\n      if (process.env.NODE_ENV !== 'production') {\n        console.log('SSE connection opened');\n      }\n    };\n\n    // Handle errors\n    eventSource.onerror = () => {\n      if (process.env.NODE_ENV !== 'production') {\n        console.error('SSE connection error');\n      }\n      onError(t('clarify.error.sseError', lang));\n      eventSource.close();\n    };\n\n    // Return a method to close the connection\n    return {\n      close: () => {\n        if (eventSource) {\n          eventSource.close();\n          if (process.env.NODE_ENV !== 'production') {\n            console.log('SSE connection closed');\n          }\n        }\n      }\n    };\n  }\n};","map":{"version":3,"names":["axios","toast","t","API_BASE_URL","process","env","REACT_APP_API_URL","api","create","baseURL","headers","withCredentials","handleApiError","error","lang","errorMessage","response","_error$response$data","data","message","request","clarificationApi","startSession","planId","post","sessionId","submitAnswer","answer","success","completeSession","createQuestionStream","onEvent","onError","window","EventSource","close","eventSource","onmessage","event","parsedEvent","JSON","parse","err","NODE_ENV","console","onopen","log","onerror"],"sources":["/home/devbox/project/src/features/clarification/utils/api.ts"],"sourcesContent":["import axios from 'axios';\nimport { toast } from 'sonner';\nimport { t } from '../../../lib/i18n';\nimport { Language } from '../../../lib/i18n';\nimport { Answer, StreamEvent } from '../types';\n\n// API base URL - should be configured based on environment\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'https://jjnucnlvlsaj.sealoshzh.site';\n\n// Create axios instance with the same config as the main API\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n  withCredentials: false,\n});\n\n// Response interface according to project requirements\ninterface ApiResponse<T> {\n  success: boolean;\n  data: T;\n  message?: string;\n}\n\n// Error handling helper\nconst handleApiError = (error: any, lang: Language = 'en'): never => {\n  let errorMessage = t('api.errors.default', lang);\n\n  if (error && error.response) {\n    if (error.response.data?.message) {\n      errorMessage = error.response.data.message;\n    }\n  } else if (error && error.request) {\n    errorMessage = t('api.errors.network', lang);\n  }\n\n  toast.error(errorMessage);\n  throw error;\n};\n\nexport const clarificationApi = {\n  // Start a new clarification session\n  startSession: async (planId?: string, lang: Language = 'en') => {\n    try {\n      const response = await api.post<ApiResponse<{ sessionId: string }>>(\n        '/clarification/sessions', \n        { planId }\n      );\n      return response.data.data.sessionId;\n    } catch (error) {\n      return handleApiError(error, lang);\n    }\n  },\n  \n  // Submit an answer to a question\n  submitAnswer: async (sessionId: string, answer: Answer, lang: Language = 'en') => {\n    try {\n      const response = await api.post<ApiResponse<{ success: boolean }>>(\n        `/clarification/sessions/${sessionId}/answers`,\n        { answer }\n      );\n      return response.data.data.success;\n    } catch (error) {\n      return handleApiError(error, lang);\n    }\n  },\n  \n  // Complete the session and generate the plan\n  completeSession: async (sessionId: string, lang: Language = 'en') => {\n    try {\n      const response = await api.post<ApiResponse<{ planId: string }>>(\n        `/clarification/sessions/${sessionId}/complete`\n      );\n      return response.data.data.planId;\n    } catch (error) {\n      return handleApiError(error, lang);\n    }\n  },\n  \n  // Create an SSE connection for streaming questions\n  createQuestionStream: (\n    sessionId: string, \n    onEvent: (event: StreamEvent) => void,\n    onError: (error: string) => void,\n    lang: Language = 'en'\n  ): { close: () => void } => {\n    // Check if EventSource is available\n    if (!window.EventSource) {\n      onError(t('clarify.error.sseError', lang));\n      return { close: () => {} };\n    }\n    \n    // Create the SSE connection\n    const eventSource = new EventSource(\n      `${API_BASE_URL}/clarification/sessions/${sessionId}/stream`\n    );\n    \n    // Handle events\n    eventSource.onmessage = (event) => {\n      try {\n        const parsedEvent: StreamEvent = JSON.parse(event.data);\n        onEvent(parsedEvent);\n      } catch (err) {\n        if (process.env.NODE_ENV !== 'production') {\n          console.error('Error parsing SSE event:', err);\n        }\n        onError(t('clarify.error.generic', lang));\n      }\n    };\n    \n    // Handle connection open\n    eventSource.onopen = () => {\n      if (process.env.NODE_ENV !== 'production') {\n        console.log('SSE connection opened');\n      }\n    };\n    \n    // Handle errors\n    eventSource.onerror = () => {\n      if (process.env.NODE_ENV !== 'production') {\n        console.error('SSE connection error');\n      }\n      onError(t('clarify.error.sseError', lang));\n      eventSource.close();\n    };\n    \n    // Return a method to close the connection\n    return {\n      close: () => {\n        if (eventSource) {\n          eventSource.close();\n          if (process.env.NODE_ENV !== 'production') {\n            console.log('SSE connection closed');\n          }\n        }\n      }\n    };\n  }\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}