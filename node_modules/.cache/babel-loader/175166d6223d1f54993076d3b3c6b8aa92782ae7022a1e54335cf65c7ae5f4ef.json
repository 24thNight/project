{"ast":null,"code":"import React,{useState,useRef,useEffect}from'react';import{Button}from'../../ui/button';import{motion,AnimatePresence}from'framer-motion';import MessageBubble from'./message-bubble';import ThinkingIndicator from'./thinking-indicator';import{toast}from'sonner';// 定义消息类型\n// 定义AI模型类型\n// 定义AI模式类型\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AIChat=_ref=>{let{initialMessages=[],onSendMessage,onClose}=_ref;const[messages,setMessages]=useState(initialMessages);const[inputValue,setInputValue]=useState('');const[status,setStatus]=useState('idle');const[selectedModel,setSelectedModel]=useState('claude-3.7-sonnet');const[mode,setMode]=useState('agent');const[isModelDropdownOpen,setIsModelDropdownOpen]=useState(false);const[isModeDropdownOpen,setIsModeDropdownOpen]=useState(false);const[references,setReferences]=useState([]);const[showReferenceSelector,setShowReferenceSelector]=useState(false);const[imageUrl,setImageUrl]=useState(undefined);const[isRecording,setIsRecording]=useState(false);const[availableFiles,setAvailableFiles]=useState(['workspace.txt','project.json','README.md','src/components/features/plan-tree/plan-tree.tsx']);const messagesEndRef=useRef(null);const inputRef=useRef(null);const modelDropdownRef=useRef(null);const modeDropdownRef=useRef(null);const fileInputRef=useRef(null);const chatContainerRef=useRef(null);// 处理点击外部关闭下拉菜单\nuseEffect(()=>{const handleClickOutside=event=>{if(modelDropdownRef.current&&!modelDropdownRef.current.contains(event.target)){setIsModelDropdownOpen(false);}if(modeDropdownRef.current&&!modeDropdownRef.current.contains(event.target)){setIsModeDropdownOpen(false);}};document.addEventListener('mousedown',handleClickOutside);return()=>{document.removeEventListener('mousedown',handleClickOutside);};},[]);// 自动滚动到最新消息\nuseEffect(()=>{if(messagesEndRef.current){messagesEndRef.current.scrollIntoView({behavior:'smooth'});}},[messages]);// 自动调整输入框高度\nuseEffect(()=>{if(inputRef.current){inputRef.current.style.height='auto';inputRef.current.style.height=`${Math.min(inputRef.current.scrollHeight,200)}px`;}},[inputValue]);// 监听容器大小变化\nuseEffect(()=>{if(!chatContainerRef.current)return;const resizeObserver=new ResizeObserver(()=>{// 强制更新滚动位置以确保消息可见\nif(messagesEndRef.current){messagesEndRef.current.scrollIntoView({behavior:'auto'});}});resizeObserver.observe(chatContainerRef.current);return()=>{resizeObserver.disconnect();};},[]);const generateId=()=>{return Date.now().toString(36)+Math.random().toString(36).substring(2);};const handleSendMessage=async()=>{if(!inputValue.trim()&&!imageUrl&&status!=='idle')return;// 创建用户消息\nconst userMessage={id:generateId(),role:'user',content:inputValue,timestamp:new Date(),references:references.length>0?[...references]:undefined,imageUrl};// 更新状态并清空输入\nsetMessages(prev=>[...prev,userMessage]);setInputValue('');setReferences([]);setImageUrl(undefined);setShowReferenceSelector(false);if(inputRef.current){inputRef.current.style.height='auto';}setStatus('thinking');try{// 如果没有提供onSendMessage回调，使用模拟响应\nconst response=onSendMessage?await onSendMessage(inputValue,references,imageUrl):await simulateResponse(inputValue,references,imageUrl);// 添加AI回复\nconst assistantMessage={id:generateId(),role:'assistant',content:response,timestamp:new Date()};setMessages(prev=>[...prev,assistantMessage]);setStatus('idle');}catch(error){console.error('Failed to get AI response:',error);setStatus('error');// 添加错误消息\nconst errorMessage={id:generateId(),role:'system',content:'抱歉，发生了错误。请稍后再试。',timestamp:new Date()};setMessages(prev=>[...prev,errorMessage]);setTimeout(()=>setStatus('idle'),3000);}};// 模拟AI响应，仅用于演示\nconst simulateResponse=async(message,refs,img)=>{// 返回模拟的响应\nreturn new Promise(resolve=>{const responses=[\"我理解你的问题。让我帮你分析一下...\",\"这是一个很好的问题。根据我的分析...\",\"我可以协助你解决这个问题。首先，你需要...\",\"让我思考一下最佳的解决方案。\",\"根据最新的研究和最佳实践，我建议...\"];let response=responses[Math.floor(Math.random()*responses.length)];if(message){response+=` 你的问题是关于\"${message}\"的。`;}// 如果有引用文件，添加相关内容\nif(refs&&refs.length>0){response+=` 我已查看了你引用的文件: ${refs.join(', ')}。`;}// 如果有图片，添加相关内容\nif(img){response+=\" 我已分析了你上传的图片。\";}if(mode==='agent'){response+=\" 作为智能体模式，我会主动帮你执行任务和提供解决方案。\";}else if(mode==='chat'){response+=\" 作为对话模式，我会回答你的问题，但不会主动执行任务。\";}else{response+=\" 作为手动模式，我需要你指导我该如何进行操作。\";}// 模拟网络延迟\nsetTimeout(()=>{resolve(response);},1500);});};// 处理输入值变化\nconst handleInputChange=e=>{const value=e.target.value;setInputValue(value);// 检测是否输入了@符号\nif(value.endsWith('@')&&!showReferenceSelector){setShowReferenceSelector(true);}};const handleKeyDown=e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleSendMessage();}else if(e.key==='@'){setShowReferenceSelector(true);}else if(e.key==='Escape'){setShowReferenceSelector(false);setIsModelDropdownOpen(false);setIsModeDropdownOpen(false);}};const handleReferenceSelect=file=>{if(!references.includes(file)){setReferences(prev=>[...prev,file]);toast.success(`已引用 ${file}`);}setShowReferenceSelector(false);};const handleRemoveReference=file=>{setReferences(prev=>prev.filter(ref=>ref!==file));};const handleImageUpload=e=>{var _e$target$files;const file=(_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0];if(file){// 在实际应用中，你可能需要将文件上传到服务器并获取URL\n// 这里我们仅模拟这个过程，生成一个临时的对象URL\nconst tempUrl=URL.createObjectURL(file);setImageUrl(tempUrl);toast.success(`已上传图片: ${file.name}`);}};const handleVoiceInput=()=>{if(!('webkitSpeechRecognition'in window)){toast.error('您的浏览器不支持语音识别功能');return;}setIsRecording(!isRecording);if(!isRecording){// 在实际应用中，你需要使用语音识别API\n// 这里我们仅模拟这个过程\ntoast.info('正在录音...');setTimeout(()=>{setInputValue(prev=>prev+\" [语音输入的文本]\");setIsRecording(false);toast.success('语音识别完成');},2000);}else{toast.info('已停止录音');}};const clearImage=()=>{setImageUrl(undefined);};const getModeLabel=()=>{switch(mode){case'agent':return'智能体模式';case'chat':return'对话模式';case'manual':return'手动模式';default:return'智能体模式';}};return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col h-full bg-white text-gray-800\",ref:chatContainerRef,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-3 py-2.5 flex justify-between items-center bg-gray-50\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 text-xs font-medium text-gray-700 truncate\",children:\"AI \\u52A9\\u624B\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",ref:modelDropdownRef,children:[/*#__PURE__*/_jsxs(\"button\",{className:\"h-7 text-xs rounded flex items-center px-2 bg-white hover:bg-gray-100 text-gray-700 border border-gray-300\",onClick:()=>setIsModelDropdownOpen(!isModelDropdownOpen),children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-3.5 h-3.5 mr-1.5\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"hidden sm:inline\",children:selectedModel}),/*#__PURE__*/_jsx(\"span\",{className:\"sm:hidden\",children:\"AI\"}),/*#__PURE__*/_jsx(\"svg\",{className:\"w-3 h-3 ml-1\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M19 9l-7 7-7-7\"})})]}),isModelDropdownOpen&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute right-0 mt-1 w-48 rounded-md shadow-lg z-10 bg-white border border-gray-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"py-1\",children:[/*#__PURE__*/_jsx(\"button\",{className:`block px-4 py-2 text-xs w-full text-left ${selectedModel==='claude-3.7-sonnet'?'bg-gray-100':''}`,onClick:()=>{setSelectedModel('claude-3.7-sonnet');setIsModelDropdownOpen(false);},children:\"claude-3.7-sonnet\"}),/*#__PURE__*/_jsx(\"button\",{className:`block px-4 py-2 text-xs w-full text-left ${selectedModel==='claude-3-opus'?'bg-gray-100':''}`,onClick:()=>{setSelectedModel('claude-3-opus');setIsModelDropdownOpen(false);},children:\"claude-3-opus\"}),/*#__PURE__*/_jsx(\"button\",{className:`block px-4 py-2 text-xs w-full text-left ${selectedModel==='gpt-4'?'bg-gray-100':''}`,onClick:()=>{setSelectedModel('gpt-4');setIsModelDropdownOpen(false);},children:\"gpt-4\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",ref:modeDropdownRef,children:[/*#__PURE__*/_jsxs(\"button\",{className:\"h-7 text-xs rounded flex items-center px-2 bg-white hover:bg-gray-100 text-gray-700 border border-gray-300\",onClick:()=>setIsModeDropdownOpen(!isModeDropdownOpen),children:[/*#__PURE__*/_jsx(\"span\",{className:\"hidden sm:inline\",children:getModeLabel()}),/*#__PURE__*/_jsx(\"span\",{className:\"sm:hidden\",children:\"\\u6A21\\u5F0F\"}),/*#__PURE__*/_jsx(\"svg\",{className:\"w-3 h-3 ml-1\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M19 9l-7 7-7-7\"})})]}),isModeDropdownOpen&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute right-0 mt-1 w-32 rounded-md shadow-lg z-10 bg-white border border-gray-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"py-1\",children:[/*#__PURE__*/_jsx(\"button\",{className:`block px-4 py-2 text-xs w-full text-left ${mode==='agent'?'bg-gray-100':''}`,onClick:()=>{setMode('agent');setIsModeDropdownOpen(false);},children:\"\\u667A\\u80FD\\u4F53\\u6A21\\u5F0F\"}),/*#__PURE__*/_jsx(\"button\",{className:`block px-4 py-2 text-xs w-full text-left ${mode==='chat'?'bg-gray-100':''}`,onClick:()=>{setMode('chat');setIsModeDropdownOpen(false);},children:\"\\u5BF9\\u8BDD\\u6A21\\u5F0F\"}),/*#__PURE__*/_jsx(\"button\",{className:`block px-4 py-2 text-xs w-full text-left ${mode==='manual'?'bg-gray-100':''}`,onClick:()=>{setMode('manual');setIsModeDropdownOpen(false);},children:\"\\u624B\\u52A8\\u6A21\\u5F0F\"})]})})]}),onClose&&/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-gray-400 hover:text-gray-600\",\"aria-label\":\"\\u5173\\u95EDAI\\u52A9\\u624B\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M13 5l7 7-7 7M5 5l7 7-7 7\"})})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-y-auto bg-white\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-4 space-y-6\",children:[/*#__PURE__*/_jsxs(AnimatePresence,{children:[messages.map(message=>/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:0.3},className:\"max-w-full\",children:/*#__PURE__*/_jsx(MessageBubble,{message:message,isDarkMode:false})},message.id)),status==='thinking'&&/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:\"max-w-full\",children:/*#__PURE__*/_jsx(ThinkingIndicator,{isDarkMode:false})})]}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]})}),imageUrl&&/*#__PURE__*/_jsx(\"div\",{className:\"px-3 pt-2 bg-white\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative inline-block\",children:[/*#__PURE__*/_jsx(\"img\",{src:imageUrl,alt:\"Uploaded\",className:\"max-h-32 rounded-md border border-gray-300\"}),/*#__PURE__*/_jsx(\"button\",{className:\"absolute top-1 right-1 bg-gray-800 bg-opacity-70 text-white rounded-full p-1\",onClick:clearImage,\"aria-label\":\"\\u5220\\u9664\\u56FE\\u7247\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M6 18L18 6M6 6l12 12\"})})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"px-3 pt-2 pb-3 bg-white\",children:[references.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-1 mb-2 text-gray-700\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-xs mt-0.5\",children:\"\\u5F15\\u7528\\u6587\\u4EF6:\"}),references.map(file=>/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs rounded px-1.5 py-0.5 flex items-center bg-blue-100 text-blue-800\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"truncate max-w-[150px]\",children:file}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleRemoveReference(file),className:\"ml-1 text-opacity-70 hover:text-opacity-100 flex-shrink-0\",\"aria-label\":`删除引用 ${file}`,children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-3 h-3\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M6 18L18 6M6 6l12 12\"})})})]},file))]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rounded-lg overflow-hidden bg-white border border-gray-300\",children:[/*#__PURE__*/_jsx(\"textarea\",{ref:inputRef,value:inputValue,onChange:handleInputChange,onKeyDown:handleKeyDown,placeholder:`向 AI 提问... (按 @ 引用文件)`,disabled:status!=='idle',className:\"w-full px-3 py-2.5 resize-none outline-none bg-white text-gray-800 placeholder-gray-400\",rows:1,style:{minHeight:'44px',maxHeight:'200px'}}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap justify-between items-center px-3 py-2 bg-gray-50 gap-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap items-center gap-x-3 gap-y-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500 whitespace-nowrap\",children:\"\\u6309 Enter \\u53D1\\u9001\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowReferenceSelector(!showReferenceSelector),className:\"text-xs flex items-center text-gray-600 hover:text-gray-700\",\"aria-label\":\"\\u5F15\\u7528\\u6587\\u4EF6\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-3.5 h-3.5 mr-1 flex-shrink-0\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"whitespace-nowrap\",children:\"\\u5F15\\u7528\\u6587\\u4EF6\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",ref:fileInputRef,onChange:handleImageUpload,accept:\"image/*\",className:\"hidden\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{var _fileInputRef$current;return(_fileInputRef$current=fileInputRef.current)===null||_fileInputRef$current===void 0?void 0:_fileInputRef$current.click();},className:\"text-xs flex items-center text-gray-600 hover:text-gray-700\",\"aria-label\":\"\\u4E0A\\u4F20\\u56FE\\u7247\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-3.5 h-3.5 mr-1 flex-shrink-0\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"whitespace-nowrap\",children:\"\\u4E0A\\u4F20\\u56FE\\u7247\"})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleVoiceInput,className:`text-xs flex items-center ${isRecording?'text-red-500':'text-gray-600 hover:text-gray-700'}`,\"aria-label\":isRecording?\"停止语音录入\":\"语音输入\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-3.5 h-3.5 mr-1 flex-shrink-0\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"whitespace-nowrap\",children:isRecording?\"录音中...\":\"语音输入\"})]})]}),/*#__PURE__*/_jsx(Button,{onClick:handleSendMessage,disabled:!inputValue.trim()&&!imageUrl||status!=='idle',className:`h-7 px-3 text-sm font-medium flex-shrink-0 ${!inputValue.trim()&&!imageUrl||status!=='idle'?'opacity-50 cursor-not-allowed':''} bg-blue-600 hover:bg-blue-700 text-white`,\"aria-label\":\"\\u53D1\\u9001\\u6D88\\u606F\",children:\"\\u53D1\\u9001\"})]})]}),showReferenceSelector&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-1 rounded-md border border-gray-300 bg-white max-h-48 overflow-y-auto shadow-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs font-medium mb-2 px-2\",children:\"\\u9009\\u62E9\\u8981\\u5F15\\u7528\\u7684\\u6587\\u4EF6\\uFF1A\"}),/*#__PURE__*/_jsx(\"div\",{children:availableFiles.map(file=>/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-1.5 text-xs rounded cursor-pointer hover:bg-gray-100\",onClick:()=>handleReferenceSelect(file),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-3.5 h-3.5 mr-2 text-gray-500 flex-shrink-0\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"truncate\",children:file})]})},file))})]})}),status==='error'&&/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-red-500 mt-1 ml-2\",children:\"\\u53D1\\u9001\\u5931\\u8D25\\uFF0C\\u8BF7\\u91CD\\u8BD5\"})]})]});};export default AIChat;","map":{"version":3,"names":["React","useState","useRef","useEffect","Button","motion","AnimatePresence","MessageBubble","ThinkingIndicator","toast","jsx","_jsx","jsxs","_jsxs","AIChat","_ref","initialMessages","onSendMessage","onClose","messages","setMessages","inputValue","setInputValue","status","setStatus","selectedModel","setSelectedModel","mode","setMode","isModelDropdownOpen","setIsModelDropdownOpen","isModeDropdownOpen","setIsModeDropdownOpen","references","setReferences","showReferenceSelector","setShowReferenceSelector","imageUrl","setImageUrl","undefined","isRecording","setIsRecording","availableFiles","setAvailableFiles","messagesEndRef","inputRef","modelDropdownRef","modeDropdownRef","fileInputRef","chatContainerRef","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","scrollIntoView","behavior","style","height","Math","min","scrollHeight","resizeObserver","ResizeObserver","observe","disconnect","generateId","Date","now","toString","random","substring","handleSendMessage","trim","userMessage","id","role","content","timestamp","length","prev","response","simulateResponse","assistantMessage","error","console","errorMessage","setTimeout","message","refs","img","Promise","resolve","responses","floor","join","handleInputChange","e","value","endsWith","handleKeyDown","key","shiftKey","preventDefault","handleReferenceSelect","file","includes","success","handleRemoveReference","filter","ref","handleImageUpload","_e$target$files","files","tempUrl","URL","createObjectURL","name","handleVoiceInput","window","info","clearImage","getModeLabel","className","children","onClick","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","map","div","initial","opacity","y","animate","transition","duration","isDarkMode","exit","src","alt","onChange","onKeyDown","placeholder","disabled","rows","minHeight","maxHeight","type","accept","_fileInputRef$current","click"],"sources":["/home/devbox/project/src/components/features/ai-chat/ai-chat.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { Button } from '../../ui/button';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport MessageBubble from './message-bubble';\nimport ThinkingIndicator from './thinking-indicator';\nimport { toast } from 'sonner';\n\n// 定义消息类型\nexport interface Message {\n  id: string;\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp: Date;\n  references?: string[]; // 引用的文件或资源\n  imageUrl?: string; // 图片URL\n}\n\n// 定义AI模型类型\ntype AIModel = 'claude-3.7-sonnet' | 'claude-3-opus' | 'gpt-4'; \n\n// 定义AI模式类型\ntype AIMode = 'agent' | 'chat' | 'manual';\n\ninterface AIChatProps {\n  initialMessages?: Message[];\n  onSendMessage?: (message: string, references?: string[], imageUrl?: string) => Promise<string>;\n  onClose?: () => void;\n}\n\nconst AIChat: React.FC<AIChatProps> = ({ \n  initialMessages = [], \n  onSendMessage,\n  onClose\n}) => {\n  const [messages, setMessages] = useState<Message[]>(initialMessages);\n  const [inputValue, setInputValue] = useState('');\n  const [status, setStatus] = useState<'idle' | 'thinking' | 'responding' | 'error'>('idle');\n  const [selectedModel, setSelectedModel] = useState<AIModel>('claude-3.7-sonnet');\n  const [mode, setMode] = useState<AIMode>('agent');\n  const [isModelDropdownOpen, setIsModelDropdownOpen] = useState(false);\n  const [isModeDropdownOpen, setIsModeDropdownOpen] = useState(false);\n  const [references, setReferences] = useState<string[]>([]);\n  const [showReferenceSelector, setShowReferenceSelector] = useState(false);\n  const [imageUrl, setImageUrl] = useState<string | undefined>(undefined);\n  const [isRecording, setIsRecording] = useState(false);\n  const [availableFiles, setAvailableFiles] = useState([\n    'workspace.txt', \n    'project.json', \n    'README.md', \n    'src/components/features/plan-tree/plan-tree.tsx'\n  ]);\n  \n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLTextAreaElement>(null);\n  const modelDropdownRef = useRef<HTMLDivElement>(null);\n  const modeDropdownRef = useRef<HTMLDivElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const chatContainerRef = useRef<HTMLDivElement>(null);\n  \n  // 处理点击外部关闭下拉菜单\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (modelDropdownRef.current && !modelDropdownRef.current.contains(event.target as Node)) {\n        setIsModelDropdownOpen(false);\n      }\n      if (modeDropdownRef.current && !modeDropdownRef.current.contains(event.target as Node)) {\n        setIsModeDropdownOpen(false);\n      }\n    };\n    \n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, []);\n\n  // 自动滚动到最新消息\n  useEffect(() => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\n    }\n  }, [messages]);\n\n  // 自动调整输入框高度\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.style.height = 'auto';\n      inputRef.current.style.height = `${Math.min(inputRef.current.scrollHeight, 200)}px`;\n    }\n  }, [inputValue]);\n\n  // 监听容器大小变化\n  useEffect(() => {\n    if (!chatContainerRef.current) return;\n    \n    const resizeObserver = new ResizeObserver(() => {\n      // 强制更新滚动位置以确保消息可见\n      if (messagesEndRef.current) {\n        messagesEndRef.current.scrollIntoView({ behavior: 'auto' });\n      }\n    });\n    \n    resizeObserver.observe(chatContainerRef.current);\n    \n    return () => {\n      resizeObserver.disconnect();\n    };\n  }, []);\n\n  const generateId = () => {\n    return Date.now().toString(36) + Math.random().toString(36).substring(2);\n  };\n\n  const handleSendMessage = async () => {\n    if (!inputValue.trim() && !imageUrl && status !== 'idle') return;\n    \n    // 创建用户消息\n    const userMessage: Message = {\n      id: generateId(),\n      role: 'user',\n      content: inputValue,\n      timestamp: new Date(),\n      references: references.length > 0 ? [...references] : undefined,\n      imageUrl\n    };\n    \n    // 更新状态并清空输入\n    setMessages(prev => [...prev, userMessage]);\n    setInputValue('');\n    setReferences([]);\n    setImageUrl(undefined);\n    setShowReferenceSelector(false);\n    if (inputRef.current) {\n      inputRef.current.style.height = 'auto';\n    }\n    setStatus('thinking');\n    \n    try {\n      // 如果没有提供onSendMessage回调，使用模拟响应\n      const response = onSendMessage \n        ? await onSendMessage(inputValue, references, imageUrl) \n        : await simulateResponse(inputValue, references, imageUrl);\n      \n      // 添加AI回复\n      const assistantMessage: Message = {\n        id: generateId(),\n        role: 'assistant',\n        content: response,\n        timestamp: new Date()\n      };\n      \n      setMessages(prev => [...prev, assistantMessage]);\n      setStatus('idle');\n    } catch (error) {\n      console.error('Failed to get AI response:', error);\n      setStatus('error');\n      \n      // 添加错误消息\n      const errorMessage: Message = {\n        id: generateId(),\n        role: 'system',\n        content: '抱歉，发生了错误。请稍后再试。',\n        timestamp: new Date()\n      };\n      \n      setMessages(prev => [...prev, errorMessage]);\n      setTimeout(() => setStatus('idle'), 3000);\n    }\n  };\n\n  // 模拟AI响应，仅用于演示\n  const simulateResponse = async (message: string, refs?: string[], img?: string): Promise<string> => {\n    // 返回模拟的响应\n    return new Promise((resolve) => {\n      const responses = [\n        \"我理解你的问题。让我帮你分析一下...\",\n        \"这是一个很好的问题。根据我的分析...\",\n        \"我可以协助你解决这个问题。首先，你需要...\",\n        \"让我思考一下最佳的解决方案。\",\n        \"根据最新的研究和最佳实践，我建议...\"\n      ];\n      \n      let response = responses[Math.floor(Math.random() * responses.length)];\n      \n      if (message) {\n        response += ` 你的问题是关于\"${message}\"的。`;\n      }\n      \n      // 如果有引用文件，添加相关内容\n      if (refs && refs.length > 0) {\n        response += ` 我已查看了你引用的文件: ${refs.join(', ')}。`;\n      }\n\n      // 如果有图片，添加相关内容\n      if (img) {\n        response += \" 我已分析了你上传的图片。\";\n      }\n      \n      if (mode === 'agent') {\n        response += \" 作为智能体模式，我会主动帮你执行任务和提供解决方案。\";\n      } else if (mode === 'chat') {\n        response += \" 作为对话模式，我会回答你的问题，但不会主动执行任务。\";\n      } else {\n        response += \" 作为手动模式，我需要你指导我该如何进行操作。\";\n      }\n      \n      // 模拟网络延迟\n      setTimeout(() => {\n        resolve(response);\n      }, 1500);\n    });\n  };\n\n  // 处理输入值变化\n  const handleInputChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    const value = e.target.value;\n    setInputValue(value);\n    \n    // 检测是否输入了@符号\n    if (value.endsWith('@') && !showReferenceSelector) {\n      setShowReferenceSelector(true);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    } else if (e.key === '@') {\n      setShowReferenceSelector(true);\n    } else if (e.key === 'Escape') {\n      setShowReferenceSelector(false);\n      setIsModelDropdownOpen(false);\n      setIsModeDropdownOpen(false);\n    }\n  };\n  \n  const handleReferenceSelect = (file: string) => {\n    if (!references.includes(file)) {\n      setReferences(prev => [...prev, file]);\n      toast.success(`已引用 ${file}`);\n    }\n    setShowReferenceSelector(false);\n  };\n  \n  const handleRemoveReference = (file: string) => {\n    setReferences(prev => prev.filter(ref => ref !== file));\n  };\n\n  const handleImageUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      // 在实际应用中，你可能需要将文件上传到服务器并获取URL\n      // 这里我们仅模拟这个过程，生成一个临时的对象URL\n      const tempUrl = URL.createObjectURL(file);\n      setImageUrl(tempUrl);\n      toast.success(`已上传图片: ${file.name}`);\n    }\n  };\n\n  const handleVoiceInput = () => {\n    if (!('webkitSpeechRecognition' in window)) {\n      toast.error('您的浏览器不支持语音识别功能');\n      return;\n    }\n\n    setIsRecording(!isRecording);\n    \n    if (!isRecording) {\n      // 在实际应用中，你需要使用语音识别API\n      // 这里我们仅模拟这个过程\n      toast.info('正在录音...');\n      setTimeout(() => {\n        setInputValue(prev => prev + \" [语音输入的文本]\");\n        setIsRecording(false);\n        toast.success('语音识别完成');\n      }, 2000);\n    } else {\n      toast.info('已停止录音');\n    }\n  };\n\n  const clearImage = () => {\n    setImageUrl(undefined);\n  };\n\n  const getModeLabel = () => {\n    switch (mode) {\n      case 'agent': return '智能体模式';\n      case 'chat': return '对话模式';\n      case 'manual': return '手动模式';\n      default: return '智能体模式';\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col h-full bg-white text-gray-800\" ref={chatContainerRef}>\n      {/* Cursor风格头部 */}\n      <div className=\"px-3 py-2.5 flex justify-between items-center bg-gray-50\">\n        <div className=\"flex-1 text-xs font-medium text-gray-700 truncate\">AI 助手</div>\n        <div className=\"flex items-center space-x-2\">\n          {/* 模型选择下拉菜单 */}\n          <div className=\"relative\" ref={modelDropdownRef}>\n            <button \n              className=\"h-7 text-xs rounded flex items-center px-2 bg-white hover:bg-gray-100 text-gray-700 border border-gray-300\"\n              onClick={() => setIsModelDropdownOpen(!isModelDropdownOpen)}\n            >\n              <svg className=\"w-3.5 h-3.5 mr-1.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z\" />\n              </svg>\n              <span className=\"hidden sm:inline\">{selectedModel}</span>\n              <span className=\"sm:hidden\">AI</span>\n              <svg className=\"w-3 h-3 ml-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n              </svg>\n            </button>\n            \n            {isModelDropdownOpen && (\n              <div className=\"absolute right-0 mt-1 w-48 rounded-md shadow-lg z-10 bg-white border border-gray-200\">\n                <div className=\"py-1\">\n                  <button\n                    className={`block px-4 py-2 text-xs w-full text-left ${\n                      selectedModel === 'claude-3.7-sonnet' ? 'bg-gray-100' : ''\n                    }`}\n                    onClick={() => {\n                      setSelectedModel('claude-3.7-sonnet');\n                      setIsModelDropdownOpen(false);\n                    }}\n                  >\n                    claude-3.7-sonnet\n                  </button>\n                  <button\n                    className={`block px-4 py-2 text-xs w-full text-left ${\n                      selectedModel === 'claude-3-opus' ? 'bg-gray-100' : ''\n                    }`}\n                    onClick={() => {\n                      setSelectedModel('claude-3-opus');\n                      setIsModelDropdownOpen(false);\n                    }}\n                  >\n                    claude-3-opus\n                  </button>\n                  <button\n                    className={`block px-4 py-2 text-xs w-full text-left ${\n                      selectedModel === 'gpt-4' ? 'bg-gray-100' : ''\n                    }`}\n                    onClick={() => {\n                      setSelectedModel('gpt-4');\n                      setIsModelDropdownOpen(false);\n                    }}\n                  >\n                    gpt-4\n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n          \n          {/* 模式选择下拉菜单 */}\n          <div className=\"relative\" ref={modeDropdownRef}>\n            <button \n              className=\"h-7 text-xs rounded flex items-center px-2 bg-white hover:bg-gray-100 text-gray-700 border border-gray-300\"\n              onClick={() => setIsModeDropdownOpen(!isModeDropdownOpen)}\n            >\n              <span className=\"hidden sm:inline\">{getModeLabel()}</span>\n              <span className=\"sm:hidden\">模式</span>\n              <svg className=\"w-3 h-3 ml-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n              </svg>\n            </button>\n            \n            {isModeDropdownOpen && (\n              <div className=\"absolute right-0 mt-1 w-32 rounded-md shadow-lg z-10 bg-white border border-gray-200\">\n                <div className=\"py-1\">\n                  <button\n                    className={`block px-4 py-2 text-xs w-full text-left ${\n                      mode === 'agent' ? 'bg-gray-100' : ''\n                    }`}\n                    onClick={() => {\n                      setMode('agent');\n                      setIsModeDropdownOpen(false);\n                    }}\n                  >\n                    智能体模式\n                  </button>\n                  <button\n                    className={`block px-4 py-2 text-xs w-full text-left ${\n                      mode === 'chat' ? 'bg-gray-100' : ''\n                    }`}\n                    onClick={() => {\n                      setMode('chat');\n                      setIsModeDropdownOpen(false);\n                    }}\n                  >\n                    对话模式\n                  </button>\n                  <button\n                    className={`block px-4 py-2 text-xs w-full text-left ${\n                      mode === 'manual' ? 'bg-gray-100' : ''\n                    }`}\n                    onClick={() => {\n                      setMode('manual');\n                      setIsModeDropdownOpen(false);\n                    }}\n                  >\n                    手动模式\n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n          \n          {/* 关闭按钮 */}\n          {onClose && (\n            <button \n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-600\"\n              aria-label=\"关闭AI助手\"\n            >\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 5l7 7-7 7M5 5l7 7-7 7\" />\n              </svg>\n            </button>\n          )}\n        </div>\n      </div>\n      \n      {/* 消息历史区域 - Cursor风格 */}\n      <div className=\"flex-1 overflow-y-auto bg-white\">\n        <div className=\"px-4 py-4 space-y-6\">\n          <AnimatePresence>\n            {messages.map((message) => (\n              <motion.div\n                key={message.id}\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.3 }}\n                className=\"max-w-full\"\n              >\n                <MessageBubble message={message} isDarkMode={false} />\n              </motion.div>\n            ))}\n            \n            {status === 'thinking' && (\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"max-w-full\"\n              >\n                <ThinkingIndicator isDarkMode={false} />\n              </motion.div>\n            )}\n          </AnimatePresence>\n          \n          {/* 用于自动滚动的引用元素 */}\n          <div ref={messagesEndRef} />\n        </div>\n      </div>\n      \n      {/* 显示上传的图片预览 */}\n      {imageUrl && (\n        <div className=\"px-3 pt-2 bg-white\">\n          <div className=\"relative inline-block\">\n            <img src={imageUrl} alt=\"Uploaded\" className=\"max-h-32 rounded-md border border-gray-300\" />\n            <button \n              className=\"absolute top-1 right-1 bg-gray-800 bg-opacity-70 text-white rounded-full p-1\"\n              onClick={clearImage}\n              aria-label=\"删除图片\"\n            >\n              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n            </button>\n          </div>\n        </div>\n      )}\n      \n      {/* 底部输入区域 - Cursor风格 */}\n      <div className=\"px-3 pt-2 pb-3 bg-white\">\n        {/* 显示已选择的引用文件 */}\n        {references.length > 0 && (\n          <div className=\"flex flex-wrap gap-1 mb-2 text-gray-700\">\n            <span className=\"text-xs mt-0.5\">引用文件:</span>\n            {references.map(file => (\n              <div \n                key={file} \n                className=\"text-xs rounded px-1.5 py-0.5 flex items-center bg-blue-100 text-blue-800\"\n              >\n                <span className=\"truncate max-w-[150px]\">{file}</span>\n                <button \n                  onClick={() => handleRemoveReference(file)}\n                  className=\"ml-1 text-opacity-70 hover:text-opacity-100 flex-shrink-0\"\n                  aria-label={`删除引用 ${file}`}\n                >\n                  <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                  </svg>\n                </button>\n              </div>\n            ))}\n          </div>\n        )}\n        \n        <div className=\"rounded-lg overflow-hidden bg-white border border-gray-300\">\n          {/* 文本输入区域 */}\n          <textarea\n            ref={inputRef}\n            value={inputValue}\n            onChange={handleInputChange}\n            onKeyDown={handleKeyDown}\n            placeholder={`向 AI 提问... (按 @ 引用文件)`}\n            disabled={status !== 'idle'}\n            className=\"w-full px-3 py-2.5 resize-none outline-none bg-white text-gray-800 placeholder-gray-400\"\n            rows={1}\n            style={{ minHeight: '44px', maxHeight: '200px' }}\n          />\n          \n          {/* 底部操作栏 */}\n          <div className=\"flex flex-wrap justify-between items-center px-3 py-2 bg-gray-50 gap-2\">\n            <div className=\"flex flex-wrap items-center gap-x-3 gap-y-1\">\n              <div className=\"text-xs text-gray-500 whitespace-nowrap\">按 Enter 发送</div>\n              \n              {/* 引用文件按钮 */}\n              <button\n                onClick={() => setShowReferenceSelector(!showReferenceSelector)}\n                className=\"text-xs flex items-center text-gray-600 hover:text-gray-700\"\n                aria-label=\"引用文件\"\n              >\n                <svg className=\"w-3.5 h-3.5 mr-1 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                </svg>\n                <span className=\"whitespace-nowrap\">引用文件</span>\n              </button>\n              \n              {/* 上传图片按钮 */}\n              <input \n                type=\"file\" \n                ref={fileInputRef}\n                onChange={handleImageUpload}\n                accept=\"image/*\"\n                className=\"hidden\"\n              />\n              <button\n                onClick={() => fileInputRef.current?.click()}\n                className=\"text-xs flex items-center text-gray-600 hover:text-gray-700\"\n                aria-label=\"上传图片\"\n              >\n                <svg className=\"w-3.5 h-3.5 mr-1 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                </svg>\n                <span className=\"whitespace-nowrap\">上传图片</span>\n              </button>\n              \n              {/* 语音转文字按钮 */}\n              <button\n                onClick={handleVoiceInput}\n                className={`text-xs flex items-center ${\n                  isRecording \n                    ? 'text-red-500' \n                    : 'text-gray-600 hover:text-gray-700'\n                }`}\n                aria-label={isRecording ? \"停止语音录入\" : \"语音输入\"}\n              >\n                <svg className=\"w-3.5 h-3.5 mr-1 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\" />\n                </svg>\n                <span className=\"whitespace-nowrap\">{isRecording ? \"录音中...\" : \"语音输入\"}</span>\n              </button>\n            </div>\n            \n            <Button \n              onClick={handleSendMessage}\n              disabled={(!inputValue.trim() && !imageUrl) || status !== 'idle'}\n              className={`h-7 px-3 text-sm font-medium flex-shrink-0 ${\n                (!inputValue.trim() && !imageUrl) || status !== 'idle'\n                  ? 'opacity-50 cursor-not-allowed'\n                  : ''\n              } bg-blue-600 hover:bg-blue-700 text-white`}\n              aria-label=\"发送消息\"\n            >\n              发送\n            </Button>\n          </div>\n        </div>\n        \n        {/* 文件引用选择器 - Cursor风格 */}\n        {showReferenceSelector && (\n          <div className=\"mt-1 rounded-md border border-gray-300 bg-white max-h-48 overflow-y-auto shadow-lg\">\n            <div className=\"p-2\">\n              <div className=\"text-xs font-medium mb-2 px-2\">选择要引用的文件：</div>\n              <div>\n                {availableFiles.map(file => (\n                  <div \n                    key={file}\n                    className=\"px-3 py-1.5 text-xs rounded cursor-pointer hover:bg-gray-100\"\n                    onClick={() => handleReferenceSelect(file)}\n                  >\n                    <div className=\"flex items-center\">\n                      <svg className=\"w-3.5 h-3.5 mr-2 text-gray-500 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                      </svg>\n                      <span className=\"truncate\">{file}</span>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n        \n        {status === 'error' && (\n          <div className=\"text-xs text-red-500 mt-1 ml-2\">发送失败，请重试</div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default AIChat; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}