{"ast":null,"code":"var _jsxFileName = \"/home/devbox/project/src/components/features/ai-chat/ai-chat.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport { Button } from '../../ui/button';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport MessageBubble from './message-bubble';\nimport ThinkingIndicator from './thinking-indicator';\nimport { toast } from 'sonner';\n\n// 定义消息类型\n\n// 定义AI模型类型\n\n// 定义AI模式类型\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AIChat = ({\n  initialMessages = [],\n  onSendMessage,\n  onClose\n}) => {\n  _s();\n  const [messages, setMessages] = useState(initialMessages);\n  const [inputValue, setInputValue] = useState('');\n  const [status, setStatus] = useState('idle');\n  const [selectedModel, setSelectedModel] = useState('claude-3.7-sonnet');\n  const [mode, setMode] = useState('agent');\n  const [isModelDropdownOpen, setIsModelDropdownOpen] = useState(false);\n  const [isModeDropdownOpen, setIsModeDropdownOpen] = useState(false);\n  const [references, setReferences] = useState([]);\n  const [showReferenceSelector, setShowReferenceSelector] = useState(false);\n  const [imageUrl, setImageUrl] = useState(undefined);\n  const [isRecording, setIsRecording] = useState(false);\n  const [availableFiles, setAvailableFiles] = useState(['workspace.txt', 'project.json', 'README.md', 'src/components/features/plan-tree/plan-tree.tsx']);\n  const messagesEndRef = useRef(null);\n  const inputRef = useRef(null);\n  const modelDropdownRef = useRef(null);\n  const modeDropdownRef = useRef(null);\n  const fileInputRef = useRef(null);\n  const chatContainerRef = useRef(null);\n\n  // 处理点击外部关闭下拉菜单\n  useEffect(() => {\n    const handleClickOutside = event => {\n      if (modelDropdownRef.current && !modelDropdownRef.current.contains(event.target)) {\n        setIsModelDropdownOpen(false);\n      }\n      if (modeDropdownRef.current && !modeDropdownRef.current.contains(event.target)) {\n        setIsModeDropdownOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, []);\n\n  // 自动滚动到最新消息\n  useEffect(() => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({\n        behavior: 'smooth'\n      });\n    }\n  }, [messages]);\n\n  // 自动调整输入框高度\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.style.height = 'auto';\n      inputRef.current.style.height = `${Math.min(inputRef.current.scrollHeight, 200)}px`;\n    }\n  }, [inputValue]);\n\n  // 监听容器大小变化\n  useEffect(() => {\n    if (!chatContainerRef.current) return;\n    const resizeObserver = new ResizeObserver(() => {\n      // 强制更新滚动位置以确保消息可见\n      if (messagesEndRef.current) {\n        messagesEndRef.current.scrollIntoView({\n          behavior: 'auto'\n        });\n      }\n    });\n    resizeObserver.observe(chatContainerRef.current);\n    return () => {\n      resizeObserver.disconnect();\n    };\n  }, []);\n  const generateId = () => {\n    return Date.now().toString(36) + Math.random().toString(36).substring(2);\n  };\n  const handleSendMessage = async () => {\n    if (!inputValue.trim() && !imageUrl && status !== 'idle') return;\n\n    // 创建用户消息\n    const userMessage = {\n      id: generateId(),\n      role: 'user',\n      content: inputValue,\n      timestamp: new Date(),\n      references: references.length > 0 ? [...references] : undefined,\n      imageUrl\n    };\n\n    // 更新状态并清空输入\n    setMessages(prev => [...prev, userMessage]);\n    setInputValue('');\n    setReferences([]);\n    setImageUrl(undefined);\n    setShowReferenceSelector(false);\n    if (inputRef.current) {\n      inputRef.current.style.height = 'auto';\n    }\n    setStatus('thinking');\n    try {\n      // 如果没有提供onSendMessage回调，使用模拟响应\n      const response = onSendMessage ? await onSendMessage(inputValue, references, imageUrl) : await simulateResponse(inputValue, references, imageUrl);\n\n      // 添加AI回复\n      const assistantMessage = {\n        id: generateId(),\n        role: 'assistant',\n        content: response,\n        timestamp: new Date()\n      };\n      setMessages(prev => [...prev, assistantMessage]);\n      setStatus('idle');\n    } catch (error) {\n      console.error('Failed to get AI response:', error);\n      setStatus('error');\n\n      // 添加错误消息\n      const errorMessage = {\n        id: generateId(),\n        role: 'system',\n        content: '抱歉，发生了错误。请稍后再试。',\n        timestamp: new Date()\n      };\n      setMessages(prev => [...prev, errorMessage]);\n      setTimeout(() => setStatus('idle'), 3000);\n    }\n  };\n\n  // 模拟AI响应，仅用于演示\n  const simulateResponse = async (message, refs, img) => {\n    // 返回模拟的响应\n    return new Promise(resolve => {\n      const responses = [\"我理解你的问题。让我帮你分析一下...\", \"这是一个很好的问题。根据我的分析...\", \"我可以协助你解决这个问题。首先，你需要...\", \"让我思考一下最佳的解决方案。\", \"根据最新的研究和最佳实践，我建议...\"];\n      let response = responses[Math.floor(Math.random() * responses.length)];\n      if (message) {\n        response += ` 你的问题是关于\"${message}\"的。`;\n      }\n\n      // 如果有引用文件，添加相关内容\n      if (refs && refs.length > 0) {\n        response += ` 我已查看了你引用的文件: ${refs.join(', ')}。`;\n      }\n\n      // 如果有图片，添加相关内容\n      if (img) {\n        response += \" 我已分析了你上传的图片。\";\n      }\n      if (mode === 'agent') {\n        response += \" 作为智能体模式，我会主动帮你执行任务和提供解决方案。\";\n      } else if (mode === 'chat') {\n        response += \" 作为对话模式，我会回答你的问题，但不会主动执行任务。\";\n      } else {\n        response += \" 作为手动模式，我需要你指导我该如何进行操作。\";\n      }\n\n      // 模拟网络延迟\n      setTimeout(() => {\n        resolve(response);\n      }, 1500);\n    });\n  };\n\n  // 处理输入值变化\n  const handleInputChange = e => {\n    const value = e.target.value;\n    setInputValue(value);\n\n    // 检测是否输入了@符号\n    if (value.endsWith('@') && !showReferenceSelector) {\n      setShowReferenceSelector(true);\n    }\n  };\n  const handleKeyDown = e => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    } else if (e.key === '@') {\n      setShowReferenceSelector(true);\n    } else if (e.key === 'Escape') {\n      setShowReferenceSelector(false);\n      setIsModelDropdownOpen(false);\n      setIsModeDropdownOpen(false);\n    }\n  };\n  const handleReferenceSelect = file => {\n    if (!references.includes(file)) {\n      setReferences(prev => [...prev, file]);\n      toast.success(`已引用 ${file}`);\n    }\n    setShowReferenceSelector(false);\n  };\n  const handleRemoveReference = file => {\n    setReferences(prev => prev.filter(ref => ref !== file));\n  };\n  const handleImageUpload = e => {\n    var _e$target$files;\n    const file = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n    if (file) {\n      // 在实际应用中，你可能需要将文件上传到服务器并获取URL\n      // 这里我们仅模拟这个过程，生成一个临时的对象URL\n      const tempUrl = URL.createObjectURL(file);\n      setImageUrl(tempUrl);\n      toast.success(`已上传图片: ${file.name}`);\n    }\n  };\n  const handleVoiceInput = () => {\n    if (!('webkitSpeechRecognition' in window)) {\n      toast.error('您的浏览器不支持语音识别功能');\n      return;\n    }\n    setIsRecording(!isRecording);\n    if (!isRecording) {\n      // 在实际应用中，你需要使用语音识别API\n      // 这里我们仅模拟这个过程\n      toast.info('正在录音...');\n      setTimeout(() => {\n        setInputValue(prev => prev + \" [语音输入的文本]\");\n        setIsRecording(false);\n        toast.success('语音识别完成');\n      }, 2000);\n    } else {\n      toast.info('已停止录音');\n    }\n  };\n  const clearImage = () => {\n    setImageUrl(undefined);\n  };\n  const getModeLabel = () => {\n    switch (mode) {\n      case 'agent':\n        return '智能体模式';\n      case 'chat':\n        return '对话模式';\n      case 'manual':\n        return '手动模式';\n      default:\n        return '智能体模式';\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col h-full bg-white text-gray-800\",\n    ref: chatContainerRef,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-3 py-2.5 flex justify-between items-center bg-gray-50\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 text-xs font-medium text-gray-700 truncate\",\n        children: \"AI \\u52A9\\u624B\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center space-x-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative\",\n          ref: modelDropdownRef,\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"h-7 text-xs rounded flex items-center px-2 bg-white hover:bg-gray-100 text-gray-700 border border-gray-300\",\n            onClick: () => setIsModelDropdownOpen(!isModelDropdownOpen),\n            children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"w-3.5 h-3.5 mr-1.5\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 309,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 308,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"hidden sm:inline\",\n              children: selectedModel\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 311,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"sm:hidden\",\n              children: \"AI\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 312,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"w-3 h-3 ml-1\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M19 9l-7 7-7-7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 314,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 313,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 304,\n            columnNumber: 13\n          }, this), isModelDropdownOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"absolute right-0 mt-1 w-48 rounded-md shadow-lg z-10 bg-white border border-gray-200\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"py-1\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: `block px-4 py-2 text-xs w-full text-left ${selectedModel === 'claude-3.7-sonnet' ? 'bg-gray-100' : ''}`,\n                onClick: () => {\n                  setSelectedModel('claude-3.7-sonnet');\n                  setIsModelDropdownOpen(false);\n                },\n                children: \"claude-3.7-sonnet\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 321,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: `block px-4 py-2 text-xs w-full text-left ${selectedModel === 'claude-3-opus' ? 'bg-gray-100' : ''}`,\n                onClick: () => {\n                  setSelectedModel('claude-3-opus');\n                  setIsModelDropdownOpen(false);\n                },\n                children: \"claude-3-opus\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 332,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: `block px-4 py-2 text-xs w-full text-left ${selectedModel === 'gpt-4' ? 'bg-gray-100' : ''}`,\n                onClick: () => {\n                  setSelectedModel('gpt-4');\n                  setIsModelDropdownOpen(false);\n                },\n                children: \"gpt-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 343,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 320,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 319,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 303,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative\",\n          ref: modeDropdownRef,\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"h-7 text-xs rounded flex items-center px-2 bg-white hover:bg-gray-100 text-gray-700 border border-gray-300\",\n            onClick: () => setIsModeDropdownOpen(!isModeDropdownOpen),\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"hidden sm:inline\",\n              children: getModeLabel()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 365,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"sm:hidden\",\n              children: \"\\u6A21\\u5F0F\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 366,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"w-3 h-3 ml-1\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M19 9l-7 7-7-7\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 368,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 367,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 361,\n            columnNumber: 13\n          }, this), isModeDropdownOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"absolute right-0 mt-1 w-32 rounded-md shadow-lg z-10 bg-white border border-gray-200\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"py-1\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: `block px-4 py-2 text-xs w-full text-left ${mode === 'agent' ? 'bg-gray-100' : ''}`,\n                onClick: () => {\n                  setMode('agent');\n                  setIsModeDropdownOpen(false);\n                },\n                children: \"\\u667A\\u80FD\\u4F53\\u6A21\\u5F0F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 375,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: `block px-4 py-2 text-xs w-full text-left ${mode === 'chat' ? 'bg-gray-100' : ''}`,\n                onClick: () => {\n                  setMode('chat');\n                  setIsModeDropdownOpen(false);\n                },\n                children: \"\\u5BF9\\u8BDD\\u6A21\\u5F0F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 386,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: `block px-4 py-2 text-xs w-full text-left ${mode === 'manual' ? 'bg-gray-100' : ''}`,\n                onClick: () => {\n                  setMode('manual');\n                  setIsModeDropdownOpen(false);\n                },\n                children: \"\\u624B\\u52A8\\u6A21\\u5F0F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 397,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 374,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 373,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 360,\n          columnNumber: 11\n        }, this), onClose && /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onClose,\n          className: \"text-gray-400 hover:text-gray-600\",\n          \"aria-label\": \"\\u5173\\u95EDAI\\u52A9\\u624B\",\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"w-5 h-5\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M13 5l7 7-7 7M5 5l7 7-7 7\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 421,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 420,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 415,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 overflow-y-auto bg-white\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"px-4 py-4 space-y-6\",\n        children: [/*#__PURE__*/_jsxDEV(AnimatePresence, {\n          children: [messages.map(message => /*#__PURE__*/_jsxDEV(motion.div, {\n            initial: {\n              opacity: 0,\n              y: 10\n            },\n            animate: {\n              opacity: 1,\n              y: 0\n            },\n            transition: {\n              duration: 0.3\n            },\n            className: \"max-w-full\",\n            children: /*#__PURE__*/_jsxDEV(MessageBubble, {\n              message: message,\n              isDarkMode: false\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 440,\n              columnNumber: 17\n            }, this)\n          }, message.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 433,\n            columnNumber: 15\n          }, this)), status === 'thinking' && /*#__PURE__*/_jsxDEV(motion.div, {\n            initial: {\n              opacity: 0\n            },\n            animate: {\n              opacity: 1\n            },\n            exit: {\n              opacity: 0\n            },\n            className: \"max-w-full\",\n            children: /*#__PURE__*/_jsxDEV(ThinkingIndicator, {\n              isDarkMode: false\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 451,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 445,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: messagesEndRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 457,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 430,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 429,\n      columnNumber: 7\n    }, this), imageUrl && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-3 pt-2 bg-white\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"relative inline-block\",\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: imageUrl,\n          alt: \"Uploaded\",\n          className: \"max-h-32 rounded-md border border-gray-300\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 465,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"absolute top-1 right-1 bg-gray-800 bg-opacity-70 text-white rounded-full p-1\",\n          onClick: clearImage,\n          \"aria-label\": \"\\u5220\\u9664\\u56FE\\u7247\",\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"w-4 h-4\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M6 18L18 6M6 6l12 12\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 472,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 471,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 466,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 464,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 463,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-3 pt-2 pb-3 bg-white\",\n      children: [references.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-wrap gap-1 mb-2 text-gray-700\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-xs mt-0.5\",\n          children: \"\\u5F15\\u7528\\u6587\\u4EF6:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 484,\n          columnNumber: 13\n        }, this), references.map(file => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-xs rounded px-1.5 py-0.5 flex items-center bg-blue-100 text-blue-800\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"truncate max-w-[150px]\",\n            children: file\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 490,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => handleRemoveReference(file),\n            className: \"ml-1 text-opacity-70 hover:text-opacity-100 flex-shrink-0\",\n            \"aria-label\": `删除引用 ${file}`,\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"w-3 h-3\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M6 18L18 6M6 6l12 12\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 497,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 496,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 491,\n            columnNumber: 17\n          }, this)]\n        }, file, true, {\n          fileName: _jsxFileName,\n          lineNumber: 486,\n          columnNumber: 15\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 483,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"rounded-lg overflow-hidden bg-white border border-gray-300\",\n        children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n          ref: inputRef,\n          value: inputValue,\n          onChange: handleInputChange,\n          onKeyDown: handleKeyDown,\n          placeholder: `向 AI 提问... (按 @ 引用文件)`,\n          disabled: status !== 'idle',\n          className: \"w-full px-3 py-2.5 resize-none outline-none bg-white text-gray-800 placeholder-gray-400\",\n          rows: 1,\n          style: {\n            minHeight: '44px',\n            maxHeight: '200px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 507,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-wrap justify-between items-center px-3 py-2 bg-gray-50 gap-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex flex-wrap items-center gap-x-3 gap-y-1\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-xs text-gray-500 whitespace-nowrap\",\n              children: \"\\u6309 Enter \\u53D1\\u9001\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 522,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setShowReferenceSelector(!showReferenceSelector),\n              className: \"text-xs flex items-center text-gray-600 hover:text-gray-700\",\n              \"aria-label\": \"\\u5F15\\u7528\\u6587\\u4EF6\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                className: \"w-3.5 h-3.5 mr-1 flex-shrink-0\",\n                fill: \"none\",\n                stroke: \"currentColor\",\n                viewBox: \"0 0 24 24\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  strokeLinecap: \"round\",\n                  strokeLinejoin: \"round\",\n                  strokeWidth: 2,\n                  d: \"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 531,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 530,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"whitespace-nowrap\",\n                children: \"\\u5F15\\u7528\\u6587\\u4EF6\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 533,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 525,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"file\",\n              ref: fileInputRef,\n              onChange: handleImageUpload,\n              accept: \"image/*\",\n              className: \"hidden\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 537,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => {\n                var _fileInputRef$current;\n                return (_fileInputRef$current = fileInputRef.current) === null || _fileInputRef$current === void 0 ? void 0 : _fileInputRef$current.click();\n              },\n              className: \"text-xs flex items-center text-gray-600 hover:text-gray-700\",\n              \"aria-label\": \"\\u4E0A\\u4F20\\u56FE\\u7247\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                className: \"w-3.5 h-3.5 mr-1 flex-shrink-0\",\n                fill: \"none\",\n                stroke: \"currentColor\",\n                viewBox: \"0 0 24 24\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  strokeLinecap: \"round\",\n                  strokeLinejoin: \"round\",\n                  strokeWidth: 2,\n                  d: \"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 550,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 549,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"whitespace-nowrap\",\n                children: \"\\u4E0A\\u4F20\\u56FE\\u7247\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 552,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 544,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: handleVoiceInput,\n              className: `text-xs flex items-center ${isRecording ? 'text-red-500' : 'text-gray-600 hover:text-gray-700'}`,\n              \"aria-label\": isRecording ? \"停止语音录入\" : \"语音输入\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                className: \"w-3.5 h-3.5 mr-1 flex-shrink-0\",\n                fill: \"none\",\n                stroke: \"currentColor\",\n                viewBox: \"0 0 24 24\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  strokeLinecap: \"round\",\n                  strokeLinejoin: \"round\",\n                  strokeWidth: 2,\n                  d: \"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 566,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 565,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"whitespace-nowrap\",\n                children: isRecording ? \"录音中...\" : \"语音输入\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 568,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 556,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 521,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            onClick: handleSendMessage,\n            disabled: !inputValue.trim() && !imageUrl || status !== 'idle',\n            className: `h-7 px-3 text-sm font-medium flex-shrink-0 ${!inputValue.trim() && !imageUrl || status !== 'idle' ? 'opacity-50 cursor-not-allowed' : ''} bg-blue-600 hover:bg-blue-700 text-white`,\n            \"aria-label\": \"\\u53D1\\u9001\\u6D88\\u606F\",\n            children: \"\\u53D1\\u9001\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 572,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 520,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 505,\n        columnNumber: 9\n      }, this), showReferenceSelector && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-1 rounded-md border border-gray-300 bg-white max-h-48 overflow-y-auto shadow-lg\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-xs font-medium mb-2 px-2\",\n            children: \"\\u9009\\u62E9\\u8981\\u5F15\\u7528\\u7684\\u6587\\u4EF6\\uFF1A\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 591,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: availableFiles.map(file => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"px-3 py-1.5 text-xs rounded cursor-pointer hover:bg-gray-100\",\n              onClick: () => handleReferenceSelect(file),\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center\",\n                children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                  className: \"w-3.5 h-3.5 mr-2 text-gray-500 flex-shrink-0\",\n                  fill: \"none\",\n                  stroke: \"currentColor\",\n                  viewBox: \"0 0 24 24\",\n                  children: /*#__PURE__*/_jsxDEV(\"path\", {\n                    strokeLinecap: \"round\",\n                    strokeLinejoin: \"round\",\n                    strokeWidth: 2,\n                    d: \"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 601,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 600,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"truncate\",\n                  children: file\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 603,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 599,\n                columnNumber: 21\n              }, this)\n            }, file, false, {\n              fileName: _jsxFileName,\n              lineNumber: 594,\n              columnNumber: 19\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 592,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 590,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 589,\n        columnNumber: 11\n      }, this), status === 'error' && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-xs text-red-500 mt-1 ml-2\",\n        children: \"\\u53D1\\u9001\\u5931\\u8D25\\uFF0C\\u8BF7\\u91CD\\u8BD5\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 613,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 480,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 297,\n    columnNumber: 5\n  }, this);\n};\n_s(AIChat, \"AGfVmmwzqTaGAjCkAZ3wuZIN38k=\");\n_c = AIChat;\nexport default AIChat;\nvar _c;\n$RefreshReg$(_c, \"AIChat\");","map":{"version":3,"names":["React","useState","useRef","useEffect","Button","motion","AnimatePresence","MessageBubble","ThinkingIndicator","toast","jsxDEV","_jsxDEV","AIChat","initialMessages","onSendMessage","onClose","_s","messages","setMessages","inputValue","setInputValue","status","setStatus","selectedModel","setSelectedModel","mode","setMode","isModelDropdownOpen","setIsModelDropdownOpen","isModeDropdownOpen","setIsModeDropdownOpen","references","setReferences","showReferenceSelector","setShowReferenceSelector","imageUrl","setImageUrl","undefined","isRecording","setIsRecording","availableFiles","setAvailableFiles","messagesEndRef","inputRef","modelDropdownRef","modeDropdownRef","fileInputRef","chatContainerRef","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","scrollIntoView","behavior","style","height","Math","min","scrollHeight","resizeObserver","ResizeObserver","observe","disconnect","generateId","Date","now","toString","random","substring","handleSendMessage","trim","userMessage","id","role","content","timestamp","length","prev","response","simulateResponse","assistantMessage","error","console","errorMessage","setTimeout","message","refs","img","Promise","resolve","responses","floor","join","handleInputChange","e","value","endsWith","handleKeyDown","key","shiftKey","preventDefault","handleReferenceSelect","file","includes","success","handleRemoveReference","filter","ref","handleImageUpload","_e$target$files","files","tempUrl","URL","createObjectURL","name","handleVoiceInput","window","info","clearImage","getModeLabel","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","map","div","initial","opacity","y","animate","transition","duration","isDarkMode","exit","src","alt","onChange","onKeyDown","placeholder","disabled","rows","minHeight","maxHeight","type","accept","_fileInputRef$current","click","_c","$RefreshReg$"],"sources":["/home/devbox/project/src/components/features/ai-chat/ai-chat.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { Button } from '../../ui/button';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport MessageBubble from './message-bubble';\nimport ThinkingIndicator from './thinking-indicator';\nimport { toast } from 'sonner';\n\n// 定义消息类型\nexport interface Message {\n  id: string;\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp: Date;\n  references?: string[]; // 引用的文件或资源\n  imageUrl?: string; // 图片URL\n}\n\n// 定义AI模型类型\ntype AIModel = 'claude-3.7-sonnet' | 'claude-3-opus' | 'gpt-4'; \n\n// 定义AI模式类型\ntype AIMode = 'agent' | 'chat' | 'manual';\n\ninterface AIChatProps {\n  initialMessages?: Message[];\n  onSendMessage?: (message: string, references?: string[], imageUrl?: string) => Promise<string>;\n  onClose?: () => void;\n}\n\nconst AIChat: React.FC<AIChatProps> = ({ \n  initialMessages = [], \n  onSendMessage,\n  onClose\n}) => {\n  const [messages, setMessages] = useState<Message[]>(initialMessages);\n  const [inputValue, setInputValue] = useState('');\n  const [status, setStatus] = useState<'idle' | 'thinking' | 'responding' | 'error'>('idle');\n  const [selectedModel, setSelectedModel] = useState<AIModel>('claude-3.7-sonnet');\n  const [mode, setMode] = useState<AIMode>('agent');\n  const [isModelDropdownOpen, setIsModelDropdownOpen] = useState(false);\n  const [isModeDropdownOpen, setIsModeDropdownOpen] = useState(false);\n  const [references, setReferences] = useState<string[]>([]);\n  const [showReferenceSelector, setShowReferenceSelector] = useState(false);\n  const [imageUrl, setImageUrl] = useState<string | undefined>(undefined);\n  const [isRecording, setIsRecording] = useState(false);\n  const [availableFiles, setAvailableFiles] = useState([\n    'workspace.txt', \n    'project.json', \n    'README.md', \n    'src/components/features/plan-tree/plan-tree.tsx'\n  ]);\n  \n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLTextAreaElement>(null);\n  const modelDropdownRef = useRef<HTMLDivElement>(null);\n  const modeDropdownRef = useRef<HTMLDivElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const chatContainerRef = useRef<HTMLDivElement>(null);\n  \n  // 处理点击外部关闭下拉菜单\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (modelDropdownRef.current && !modelDropdownRef.current.contains(event.target as Node)) {\n        setIsModelDropdownOpen(false);\n      }\n      if (modeDropdownRef.current && !modeDropdownRef.current.contains(event.target as Node)) {\n        setIsModeDropdownOpen(false);\n      }\n    };\n    \n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, []);\n\n  // 自动滚动到最新消息\n  useEffect(() => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\n    }\n  }, [messages]);\n\n  // 自动调整输入框高度\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.style.height = 'auto';\n      inputRef.current.style.height = `${Math.min(inputRef.current.scrollHeight, 200)}px`;\n    }\n  }, [inputValue]);\n\n  // 监听容器大小变化\n  useEffect(() => {\n    if (!chatContainerRef.current) return;\n    \n    const resizeObserver = new ResizeObserver(() => {\n      // 强制更新滚动位置以确保消息可见\n      if (messagesEndRef.current) {\n        messagesEndRef.current.scrollIntoView({ behavior: 'auto' });\n      }\n    });\n    \n    resizeObserver.observe(chatContainerRef.current);\n    \n    return () => {\n      resizeObserver.disconnect();\n    };\n  }, []);\n\n  const generateId = () => {\n    return Date.now().toString(36) + Math.random().toString(36).substring(2);\n  };\n\n  const handleSendMessage = async () => {\n    if (!inputValue.trim() && !imageUrl && status !== 'idle') return;\n    \n    // 创建用户消息\n    const userMessage: Message = {\n      id: generateId(),\n      role: 'user',\n      content: inputValue,\n      timestamp: new Date(),\n      references: references.length > 0 ? [...references] : undefined,\n      imageUrl\n    };\n    \n    // 更新状态并清空输入\n    setMessages(prev => [...prev, userMessage]);\n    setInputValue('');\n    setReferences([]);\n    setImageUrl(undefined);\n    setShowReferenceSelector(false);\n    if (inputRef.current) {\n      inputRef.current.style.height = 'auto';\n    }\n    setStatus('thinking');\n    \n    try {\n      // 如果没有提供onSendMessage回调，使用模拟响应\n      const response = onSendMessage \n        ? await onSendMessage(inputValue, references, imageUrl) \n        : await simulateResponse(inputValue, references, imageUrl);\n      \n      // 添加AI回复\n      const assistantMessage: Message = {\n        id: generateId(),\n        role: 'assistant',\n        content: response,\n        timestamp: new Date()\n      };\n      \n      setMessages(prev => [...prev, assistantMessage]);\n      setStatus('idle');\n    } catch (error) {\n      console.error('Failed to get AI response:', error);\n      setStatus('error');\n      \n      // 添加错误消息\n      const errorMessage: Message = {\n        id: generateId(),\n        role: 'system',\n        content: '抱歉，发生了错误。请稍后再试。',\n        timestamp: new Date()\n      };\n      \n      setMessages(prev => [...prev, errorMessage]);\n      setTimeout(() => setStatus('idle'), 3000);\n    }\n  };\n\n  // 模拟AI响应，仅用于演示\n  const simulateResponse = async (message: string, refs?: string[], img?: string): Promise<string> => {\n    // 返回模拟的响应\n    return new Promise((resolve) => {\n      const responses = [\n        \"我理解你的问题。让我帮你分析一下...\",\n        \"这是一个很好的问题。根据我的分析...\",\n        \"我可以协助你解决这个问题。首先，你需要...\",\n        \"让我思考一下最佳的解决方案。\",\n        \"根据最新的研究和最佳实践，我建议...\"\n      ];\n      \n      let response = responses[Math.floor(Math.random() * responses.length)];\n      \n      if (message) {\n        response += ` 你的问题是关于\"${message}\"的。`;\n      }\n      \n      // 如果有引用文件，添加相关内容\n      if (refs && refs.length > 0) {\n        response += ` 我已查看了你引用的文件: ${refs.join(', ')}。`;\n      }\n\n      // 如果有图片，添加相关内容\n      if (img) {\n        response += \" 我已分析了你上传的图片。\";\n      }\n      \n      if (mode === 'agent') {\n        response += \" 作为智能体模式，我会主动帮你执行任务和提供解决方案。\";\n      } else if (mode === 'chat') {\n        response += \" 作为对话模式，我会回答你的问题，但不会主动执行任务。\";\n      } else {\n        response += \" 作为手动模式，我需要你指导我该如何进行操作。\";\n      }\n      \n      // 模拟网络延迟\n      setTimeout(() => {\n        resolve(response);\n      }, 1500);\n    });\n  };\n\n  // 处理输入值变化\n  const handleInputChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    const value = e.target.value;\n    setInputValue(value);\n    \n    // 检测是否输入了@符号\n    if (value.endsWith('@') && !showReferenceSelector) {\n      setShowReferenceSelector(true);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    } else if (e.key === '@') {\n      setShowReferenceSelector(true);\n    } else if (e.key === 'Escape') {\n      setShowReferenceSelector(false);\n      setIsModelDropdownOpen(false);\n      setIsModeDropdownOpen(false);\n    }\n  };\n  \n  const handleReferenceSelect = (file: string) => {\n    if (!references.includes(file)) {\n      setReferences(prev => [...prev, file]);\n      toast.success(`已引用 ${file}`);\n    }\n    setShowReferenceSelector(false);\n  };\n  \n  const handleRemoveReference = (file: string) => {\n    setReferences(prev => prev.filter(ref => ref !== file));\n  };\n\n  const handleImageUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      // 在实际应用中，你可能需要将文件上传到服务器并获取URL\n      // 这里我们仅模拟这个过程，生成一个临时的对象URL\n      const tempUrl = URL.createObjectURL(file);\n      setImageUrl(tempUrl);\n      toast.success(`已上传图片: ${file.name}`);\n    }\n  };\n\n  const handleVoiceInput = () => {\n    if (!('webkitSpeechRecognition' in window)) {\n      toast.error('您的浏览器不支持语音识别功能');\n      return;\n    }\n\n    setIsRecording(!isRecording);\n    \n    if (!isRecording) {\n      // 在实际应用中，你需要使用语音识别API\n      // 这里我们仅模拟这个过程\n      toast.info('正在录音...');\n      setTimeout(() => {\n        setInputValue(prev => prev + \" [语音输入的文本]\");\n        setIsRecording(false);\n        toast.success('语音识别完成');\n      }, 2000);\n    } else {\n      toast.info('已停止录音');\n    }\n  };\n\n  const clearImage = () => {\n    setImageUrl(undefined);\n  };\n\n  const getModeLabel = () => {\n    switch (mode) {\n      case 'agent': return '智能体模式';\n      case 'chat': return '对话模式';\n      case 'manual': return '手动模式';\n      default: return '智能体模式';\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col h-full bg-white text-gray-800\" ref={chatContainerRef}>\n      {/* Cursor风格头部 */}\n      <div className=\"px-3 py-2.5 flex justify-between items-center bg-gray-50\">\n        <div className=\"flex-1 text-xs font-medium text-gray-700 truncate\">AI 助手</div>\n        <div className=\"flex items-center space-x-2\">\n          {/* 模型选择下拉菜单 */}\n          <div className=\"relative\" ref={modelDropdownRef}>\n            <button \n              className=\"h-7 text-xs rounded flex items-center px-2 bg-white hover:bg-gray-100 text-gray-700 border border-gray-300\"\n              onClick={() => setIsModelDropdownOpen(!isModelDropdownOpen)}\n            >\n              <svg className=\"w-3.5 h-3.5 mr-1.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z\" />\n              </svg>\n              <span className=\"hidden sm:inline\">{selectedModel}</span>\n              <span className=\"sm:hidden\">AI</span>\n              <svg className=\"w-3 h-3 ml-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n              </svg>\n            </button>\n            \n            {isModelDropdownOpen && (\n              <div className=\"absolute right-0 mt-1 w-48 rounded-md shadow-lg z-10 bg-white border border-gray-200\">\n                <div className=\"py-1\">\n                  <button\n                    className={`block px-4 py-2 text-xs w-full text-left ${\n                      selectedModel === 'claude-3.7-sonnet' ? 'bg-gray-100' : ''\n                    }`}\n                    onClick={() => {\n                      setSelectedModel('claude-3.7-sonnet');\n                      setIsModelDropdownOpen(false);\n                    }}\n                  >\n                    claude-3.7-sonnet\n                  </button>\n                  <button\n                    className={`block px-4 py-2 text-xs w-full text-left ${\n                      selectedModel === 'claude-3-opus' ? 'bg-gray-100' : ''\n                    }`}\n                    onClick={() => {\n                      setSelectedModel('claude-3-opus');\n                      setIsModelDropdownOpen(false);\n                    }}\n                  >\n                    claude-3-opus\n                  </button>\n                  <button\n                    className={`block px-4 py-2 text-xs w-full text-left ${\n                      selectedModel === 'gpt-4' ? 'bg-gray-100' : ''\n                    }`}\n                    onClick={() => {\n                      setSelectedModel('gpt-4');\n                      setIsModelDropdownOpen(false);\n                    }}\n                  >\n                    gpt-4\n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n          \n          {/* 模式选择下拉菜单 */}\n          <div className=\"relative\" ref={modeDropdownRef}>\n            <button \n              className=\"h-7 text-xs rounded flex items-center px-2 bg-white hover:bg-gray-100 text-gray-700 border border-gray-300\"\n              onClick={() => setIsModeDropdownOpen(!isModeDropdownOpen)}\n            >\n              <span className=\"hidden sm:inline\">{getModeLabel()}</span>\n              <span className=\"sm:hidden\">模式</span>\n              <svg className=\"w-3 h-3 ml-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n              </svg>\n            </button>\n            \n            {isModeDropdownOpen && (\n              <div className=\"absolute right-0 mt-1 w-32 rounded-md shadow-lg z-10 bg-white border border-gray-200\">\n                <div className=\"py-1\">\n                  <button\n                    className={`block px-4 py-2 text-xs w-full text-left ${\n                      mode === 'agent' ? 'bg-gray-100' : ''\n                    }`}\n                    onClick={() => {\n                      setMode('agent');\n                      setIsModeDropdownOpen(false);\n                    }}\n                  >\n                    智能体模式\n                  </button>\n                  <button\n                    className={`block px-4 py-2 text-xs w-full text-left ${\n                      mode === 'chat' ? 'bg-gray-100' : ''\n                    }`}\n                    onClick={() => {\n                      setMode('chat');\n                      setIsModeDropdownOpen(false);\n                    }}\n                  >\n                    对话模式\n                  </button>\n                  <button\n                    className={`block px-4 py-2 text-xs w-full text-left ${\n                      mode === 'manual' ? 'bg-gray-100' : ''\n                    }`}\n                    onClick={() => {\n                      setMode('manual');\n                      setIsModeDropdownOpen(false);\n                    }}\n                  >\n                    手动模式\n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n          \n          {/* 关闭按钮 */}\n          {onClose && (\n            <button \n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-600\"\n              aria-label=\"关闭AI助手\"\n            >\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 5l7 7-7 7M5 5l7 7-7 7\" />\n              </svg>\n            </button>\n          )}\n        </div>\n      </div>\n      \n      {/* 消息历史区域 - Cursor风格 */}\n      <div className=\"flex-1 overflow-y-auto bg-white\">\n        <div className=\"px-4 py-4 space-y-6\">\n          <AnimatePresence>\n            {messages.map((message) => (\n              <motion.div\n                key={message.id}\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.3 }}\n                className=\"max-w-full\"\n              >\n                <MessageBubble message={message} isDarkMode={false} />\n              </motion.div>\n            ))}\n            \n            {status === 'thinking' && (\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"max-w-full\"\n              >\n                <ThinkingIndicator isDarkMode={false} />\n              </motion.div>\n            )}\n          </AnimatePresence>\n          \n          {/* 用于自动滚动的引用元素 */}\n          <div ref={messagesEndRef} />\n        </div>\n      </div>\n      \n      {/* 显示上传的图片预览 */}\n      {imageUrl && (\n        <div className=\"px-3 pt-2 bg-white\">\n          <div className=\"relative inline-block\">\n            <img src={imageUrl} alt=\"Uploaded\" className=\"max-h-32 rounded-md border border-gray-300\" />\n            <button \n              className=\"absolute top-1 right-1 bg-gray-800 bg-opacity-70 text-white rounded-full p-1\"\n              onClick={clearImage}\n              aria-label=\"删除图片\"\n            >\n              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n            </button>\n          </div>\n        </div>\n      )}\n      \n      {/* 底部输入区域 - Cursor风格 */}\n      <div className=\"px-3 pt-2 pb-3 bg-white\">\n        {/* 显示已选择的引用文件 */}\n        {references.length > 0 && (\n          <div className=\"flex flex-wrap gap-1 mb-2 text-gray-700\">\n            <span className=\"text-xs mt-0.5\">引用文件:</span>\n            {references.map(file => (\n              <div \n                key={file} \n                className=\"text-xs rounded px-1.5 py-0.5 flex items-center bg-blue-100 text-blue-800\"\n              >\n                <span className=\"truncate max-w-[150px]\">{file}</span>\n                <button \n                  onClick={() => handleRemoveReference(file)}\n                  className=\"ml-1 text-opacity-70 hover:text-opacity-100 flex-shrink-0\"\n                  aria-label={`删除引用 ${file}`}\n                >\n                  <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                  </svg>\n                </button>\n              </div>\n            ))}\n          </div>\n        )}\n        \n        <div className=\"rounded-lg overflow-hidden bg-white border border-gray-300\">\n          {/* 文本输入区域 */}\n          <textarea\n            ref={inputRef}\n            value={inputValue}\n            onChange={handleInputChange}\n            onKeyDown={handleKeyDown}\n            placeholder={`向 AI 提问... (按 @ 引用文件)`}\n            disabled={status !== 'idle'}\n            className=\"w-full px-3 py-2.5 resize-none outline-none bg-white text-gray-800 placeholder-gray-400\"\n            rows={1}\n            style={{ minHeight: '44px', maxHeight: '200px' }}\n          />\n          \n          {/* 底部操作栏 */}\n          <div className=\"flex flex-wrap justify-between items-center px-3 py-2 bg-gray-50 gap-2\">\n            <div className=\"flex flex-wrap items-center gap-x-3 gap-y-1\">\n              <div className=\"text-xs text-gray-500 whitespace-nowrap\">按 Enter 发送</div>\n              \n              {/* 引用文件按钮 */}\n              <button\n                onClick={() => setShowReferenceSelector(!showReferenceSelector)}\n                className=\"text-xs flex items-center text-gray-600 hover:text-gray-700\"\n                aria-label=\"引用文件\"\n              >\n                <svg className=\"w-3.5 h-3.5 mr-1 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                </svg>\n                <span className=\"whitespace-nowrap\">引用文件</span>\n              </button>\n              \n              {/* 上传图片按钮 */}\n              <input \n                type=\"file\" \n                ref={fileInputRef}\n                onChange={handleImageUpload}\n                accept=\"image/*\"\n                className=\"hidden\"\n              />\n              <button\n                onClick={() => fileInputRef.current?.click()}\n                className=\"text-xs flex items-center text-gray-600 hover:text-gray-700\"\n                aria-label=\"上传图片\"\n              >\n                <svg className=\"w-3.5 h-3.5 mr-1 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                </svg>\n                <span className=\"whitespace-nowrap\">上传图片</span>\n              </button>\n              \n              {/* 语音转文字按钮 */}\n              <button\n                onClick={handleVoiceInput}\n                className={`text-xs flex items-center ${\n                  isRecording \n                    ? 'text-red-500' \n                    : 'text-gray-600 hover:text-gray-700'\n                }`}\n                aria-label={isRecording ? \"停止语音录入\" : \"语音输入\"}\n              >\n                <svg className=\"w-3.5 h-3.5 mr-1 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\" />\n                </svg>\n                <span className=\"whitespace-nowrap\">{isRecording ? \"录音中...\" : \"语音输入\"}</span>\n              </button>\n            </div>\n            \n            <Button \n              onClick={handleSendMessage}\n              disabled={(!inputValue.trim() && !imageUrl) || status !== 'idle'}\n              className={`h-7 px-3 text-sm font-medium flex-shrink-0 ${\n                (!inputValue.trim() && !imageUrl) || status !== 'idle'\n                  ? 'opacity-50 cursor-not-allowed'\n                  : ''\n              } bg-blue-600 hover:bg-blue-700 text-white`}\n              aria-label=\"发送消息\"\n            >\n              发送\n            </Button>\n          </div>\n        </div>\n        \n        {/* 文件引用选择器 - Cursor风格 */}\n        {showReferenceSelector && (\n          <div className=\"mt-1 rounded-md border border-gray-300 bg-white max-h-48 overflow-y-auto shadow-lg\">\n            <div className=\"p-2\">\n              <div className=\"text-xs font-medium mb-2 px-2\">选择要引用的文件：</div>\n              <div>\n                {availableFiles.map(file => (\n                  <div \n                    key={file}\n                    className=\"px-3 py-1.5 text-xs rounded cursor-pointer hover:bg-gray-100\"\n                    onClick={() => handleReferenceSelect(file)}\n                  >\n                    <div className=\"flex items-center\">\n                      <svg className=\"w-3.5 h-3.5 mr-2 text-gray-500 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                      </svg>\n                      <span className=\"truncate\">{file}</span>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n        \n        {status === 'error' && (\n          <div className=\"text-xs text-red-500 mt-1 ml-2\">发送失败，请重试</div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default AIChat; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}